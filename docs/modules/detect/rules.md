---
sidebar_position: 3
title: Detection Rules
---

Detection rules define the logic that the Detect module uses to identify threats and generate alerts. Z Shield supports both a curated library of pre-built rules and fully custom rules authored by your team.

## SIGMA-Compatible Rule Format

Z Shield uses a rule format compatible with the SIGMA open standard for detection rules. SIGMA is a widely adopted, vendor-agnostic format that allows security teams to write portable detection logic. If you already maintain SIGMA rules, you can import them directly into Z Shield.

A basic rule definition looks like this:

```yaml
title: Brute Force Login Attempt
id: a]3f8e2b-1c4d-4a5e-9f6a-7b8c9d0e1f2a
status: production
level: high
description: Detects multiple failed login attempts from a single source IP.
logsource:
  category: authentication
  product: any
detection:
  selection:
    event_type: authentication
    outcome: failure
  condition: selection | count(source_ip) > 10
  timeframe: 5m
tags:
  - attack.credential_access
  - attack.t1110
```

## Pre-Built Rule Library

Z Shield ships with hundreds of pre-built detection rules covering common threat scenarios across cloud infrastructure, identity systems, endpoints, and network traffic. Pre-built rules are organized into rule packs by category:

- **Cloud Security** -- Unauthorized API calls, insecure storage configurations, privilege escalation in AWS/Azure/GCP.
- **Identity and Access** -- Brute force attacks, impossible travel, suspicious OAuth grants, MFA bypass.
- **Endpoint Threats** -- Malware execution patterns, persistence mechanisms, credential dumping.
- **Network Anomalies** -- Beaconing behavior, DNS tunneling, unusual data transfers.

Pre-built rules are maintained and updated by the Z Shield threat research team. Updates are applied automatically unless you have customized a rule.

## Custom Rules

To create a custom rule, navigate to **Detect > Rules** and click **New Rule**. The rule editor provides:

- A YAML editor with syntax highlighting and validation.
- A field reference panel listing all available OCSF fields.
- Auto-complete for log source categories and event types.

### Rule Severity

Each rule must specify a severity level: Critical, High, Medium, Low, or Info. This severity is used as the default for any alerts generated by the rule, though it may be adjusted by the correlation engine based on asset criticality and environmental context.

## Rule Testing

Before activating a new rule, use the **Test Rule** feature to evaluate it against historical log data. The tester runs the rule against a configurable time range and returns:

- The number of events that would match.
- Sample matching events with highlighted fields.
- Estimated alert volume per day based on recent data patterns.

This allows you to validate rule logic and tune thresholds before the rule enters production.

## Rule Lifecycle

Rules can be in one of the following states:

- **Draft** -- Under development, not evaluated against live data.
- **Testing** -- Being validated against historical data.
- **Production** -- Active and generating alerts.
- **Disabled** -- Temporarily deactivated without deletion.
